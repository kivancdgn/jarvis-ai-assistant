<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J.A.R.V.I.S - Sesli Asistan</title>
    <meta name="description" content="Jarvis AI Sesli Asistan - Kıvanç Tarafından Oluşturulmuş">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'nature-green': '#10b981',
                        'nature-emerald': '#059669',
                        'tech-blue': '#3b82f6',
                        'tech-cyan': '#06b6d4',
                        'forest': '#1e40af',
                        'leaf': '#65a30d',
                    }
                }
            }
        }
    </script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            background: 
                radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(16, 185, 129, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(6, 182, 212, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 25%, #f0f9ff 50%, #eff6ff 75%, #f0fdf4 100%);
            background-attachment: fixed;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                url('data:image/svg+xml,<svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><g fill="%233b82f6" fill-opacity="0.03"><path d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/></g></g></svg>');
            opacity: 0.5;
            pointer-events: none;
        }

        /* Scrollbar Styles */
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: transparent;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.7);
        }

        /* Custom Animations */
        @keyframes slide-in-from-bottom {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: slide-in-from-bottom 0.3s ease-out;
        }



        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translate3d(0,0,0);
            }
            40%, 43% {
                transform: translate3d(0, -8px, 0);
            }
            70% {
                transform: translate3d(0, -4px, 0);
            }
            90% {
                transform: translate3d(0, -2px, 0);
            }
        }

        .animate-bounce {
            animation: bounce 1s infinite;
        }

        .animate-ping {
            animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        @keyframes ping {
            75%, 100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* Emergent watermark'ını gizle */
        [class*="emergent"],
        [id*="emergent"],
        [data-emergent],
        a[href*="emergent.sh"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }

        /* Custom CSS Variables */
        :root {
            --background: 0 0% 100%;
            --foreground: 0 0% 3.9%;
            --card: 0 0% 100%;
            --card-foreground: 0 0% 3.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 0 0% 3.9%;
            --primary: 0 0% 9%;
            --primary-foreground: 0 0% 98%;
            --secondary: 0 0% 96.1%;
            --secondary-foreground: 0 0% 9%;
            --muted: 0 0% 96.1%;
            --muted-foreground: 0 0% 45.1%;
            --accent: 0 0% 96.1%;
            --accent-foreground: 0 0% 9%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 0 0% 98%;
            --border: 0 0% 89.8%;
            --input: 0 0% 89.8%;
            --ring: 0 0% 3.9%;
            --radius: 0.5rem;
        }

        .dark {
            --background: 0 0% 3.9%;
            --foreground: 0 0% 98%;
            --card: 0 0% 3.9%;
            --card-foreground: 0 0% 98%;
            --popover: 0 0% 3.9%;
            --popover-foreground: 0 0% 98%;
            --primary: 0 0% 98%;
            --primary-foreground: 0 0% 9%;
            --secondary: 0 0% 14.9%;
            --secondary-foreground: 0 0% 98%;
            --muted: 0 0% 14.9%;
            --muted-foreground: 0 0% 63.9%;
            --accent: 0 0% 14.9%;
            --accent-foreground: 0 0% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 0 0% 98%;
            --border: 0 0% 14.9%;
            --input: 0 0% 14.9%;
            --ring: 0 0% 83.1%;
        }
    </style>
</head>
<body class="dark">
    <div id="root"></div>

    <!-- Güvenlik Sistemi -->
    <script>
        // Güvenlik Koruma Sistemi - Kıvanç Tarafından Oluşturulmuş
        (function() {
            'use strict';

            // Sağ tık koruması
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                console.log('⚠️ Sağ tık devre dışı bırakıldı!');
                return false;
            });

            // F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U kısayol tuşlarını engelle
            document.addEventListener('keydown', function(e) {
                // F12
                if (e.keyCode === 123) {
                    e.preventDefault();
                    return false;
                }
                // Ctrl+Shift+I
                if (e.ctrlKey && e.shiftKey && e.keyCode === 73) {
                    e.preventDefault();
                    return false;
                }
                // Ctrl+Shift+J
                if (e.ctrlKey && e.shiftKey && e.keyCode === 74) {
                    e.preventDefault();
                    return false;
                }
                // Ctrl+U
                if (e.ctrlKey && e.keyCode === 85) {
                    e.preventDefault();
                    return false;
                }
                // Ctrl+S
                if (e.ctrlKey && e.keyCode === 83) {
                    e.preventDefault();
                    return false;
                }
            });

            // Console'u kilitle
            const disableConsole = () => {
                const noop = () => {};
                const methods = ['log', 'debug', 'info', 'warn', 'error', 'dir', 'dirxml', 'trace', 'assert', 'profile', 'profileEnd'];
                
                methods.forEach(method => {
                    window.console[method] = noop;
                });
            };

            // DevTools açık mı kontrol et
            let devtoolsOpen = false;
            const threshold = 160;

            const checkDevTools = () => {
                const widthThreshold = window.outerWidth - window.innerWidth > threshold;
                const heightThreshold = window.outerHeight - window.innerHeight > threshold;
                
                if (widthThreshold || heightThreshold) {
                    if (!devtoolsOpen) {
                        devtoolsOpen = true;
                        // DevTools açıldığında konsolu kilitle
                        disableConsole();
                    }
                } else {
                    devtoolsOpen = false;
                }
            };

            // Her saniye kontrol et
            setInterval(checkDevTools, 1000);

            // Debugger trap
            setInterval(() => {
                (function() {
                    return false;
                })();
            }, 100);

            // Kopyalamayı engelle
            document.addEventListener('copy', function(e) {
                e.preventDefault();
                return false;
            });

            // Seçimi engelle
            document.addEventListener('selectstart', function(e) {
                if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    return false;
                }
            });

            // Sürükle-bırak engelle
            document.addEventListener('dragstart', function(e) {
                e.preventDefault();
                return false;
            });

            // Console clear
            if (window.console) {
                console.clear();
                console.log('%c🔒 GÜVENLİK UYARISI', 'color: red; font-size: 40px; font-weight: bold;');
                console.log('%cBu konsol geliştiriciler içindir!', 'color: orange; font-size: 20px;');
                console.log('%cBuraya kod yapıştırmak hesabınızı riske atabilir!', 'color: yellow; font-size: 16px;');
                console.log('%cKıvanç Tarafından Oluşturulmuş Güvenlik Sistemi', 'color: cyan; font-size: 12px;');
            }

            // Sayfa kaynak kodunu gizle
            Object.defineProperty(document, 'hidden', {
                get: function() { return true; },
                set: function() { return true; }
            });

            // Anti-debugging
            (function() {
                function detectDevTool(allow) {
                    if (isNaN(+allow)) allow = 100;
                    var start = +new Date();
                    debugger;
                    var end = +new Date();
                    if (isNaN(start) || isNaN(end) || end - start > allow) {
                        document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#000;color:#fff;font-size:24px;">🔒 Geliştirici araçları algılandı!</div>';
                    }
                }
                if (window.attachEvent) {
                    window.attachEvent('onload', detectDevTool);
                    window.attachEvent('onresize', detectDevTool);
                } else {
                    window.addEventListener('load', detectDevTool);
                    window.addEventListener('resize', detectDevTool);
                }
            })();

            console.log('✅ Güvenlik sistemi aktif - Kıvanç');
        })();
    </script>

    <!-- React ve Ana Uygulama -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Rate Limiting System
        const MAX_QUESTIONS = 50;
        const COOLDOWN_MINUTES = 15;
        
        // Load question count from localStorage
        const getQuestionCount = () => {
            const count = localStorage.getItem('jarvis_question_count');
            return count ? parseInt(count) : 0;
        };
        
        // Save question count to localStorage
        const saveQuestionCount = (count) => {
            localStorage.setItem('jarvis_question_count', count.toString());
        };
        
        // Get cooldown end time
        const getCooldownEndTime = () => {
            const endTime = localStorage.getItem('jarvis_cooldown_end');
            return endTime ? parseInt(endTime) : null;
        };
        
        // Set cooldown end time
        const setCooldownEndTime = () => {
            const endTime = Date.now() + (COOLDOWN_MINUTES * 60 * 1000);
            localStorage.setItem('jarvis_cooldown_end', endTime.toString());
        };
        
        // Check if user is in cooldown
        const isInCooldown = () => {
            const endTime = getCooldownEndTime();
            if (!endTime) return false;
            
            const now = Date.now();
            return now < endTime;
        };
        
        // Get remaining cooldown time
        const getRemainingCooldownTime = () => {
            const endTime = getCooldownEndTime();
            if (!endTime) return 0;
            
            const now = Date.now();
            const remaining = endTime - now;
            return remaining > 0 ? Math.ceil(remaining / 1000) : 0;
        };
        
        // Reset question count (for testing)
        const resetQuestionCount = () => {
            localStorage.removeItem('jarvis_question_count');
            localStorage.removeItem('jarvis_cooldown_end');
        };
        
        // Format time for display
        const formatTime = (seconds) => {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        };

        // Groq API Configuration
        // API anahtarınızı almak için: https://console.groq.com/keys
        const GROQ_API_KEY = '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'; // API anahtarı ayarlandı
        const GROQ_MODEL = 'llama-3.1-8b-instant'; // Çok hızlı model
        
        // API anahtarı ayarlama talimatları:
        // 1. https://console.groq.com/keys adresine gidin
        // 2. "Create API Key" butonuna tıklayın
        // 3. Key name verin (örn: "jarvis-ai")
        // 4. Oluşturulan key'i kopyalayın
        // 5. Yukarıdaki GROQ_API_KEY değişkenine yapıştırın
        
        // Fallback responses for when API fails
        const fallbackResponses = [
            "Merhaba efendim! Size nasıl yardımcı olabilirim?",
            "Tabii efendim, size yardımcı olmaktan memnuniyet duyarım.",
            "Efendim, bu konuda size detaylı bilgi verebilirim.",
            "Anlıyorum efendim, bu konuda size yardımcı olabilirim.",
            "Efendim, bu sorunuz için en iyi çözümü sunacağım.",
            "Tabii ki efendim, bu konuda size rehberlik edebilirim.",
            "Efendim, bu konuda uzmanım ve size yardımcı olabilirim.",
            "Merhaba efendim! Bugün nasılsınız? Size nasıl yardımcı olabilirim?",
            "Efendim, bu konuda size en güncel bilgileri sunacağım.",
            "Tabii efendim, bu konuda size detaylı açıklama yapabilirim."
        ];

        // Web Search API Configuration
        const SEARCH_API_KEY = 'YOUR_SEARCH_API_KEY'; // SerpAPI veya Google Custom Search
        const SEARCH_ENGINE_ID = 'YOUR_SEARCH_ENGINE_ID'; // Google Custom Search için
        
        // Web search function
        const searchWeb = async (query) => {
            try {
                // DuckDuckGo Instant Answer API (ücretsiz)
                const response = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_html=1&skip_disambig=1`);
                const data = await response.json();
                
                if (data.Abstract) {
                    return data.Abstract;
                } else if (data.RelatedTopics && data.RelatedTopics.length > 0) {
                    return data.RelatedTopics[0].Text;
                }
                
                return null;
            } catch (error) {
                console.error('Web search error:', error);
                return null;
            }
        };

        // Enhanced AI response with web search
        const getEnhancedAIResponse = async (userMessage) => {
            try {
                console.log('🤖 Enhanced AI çağrısı başlatılıyor...', userMessage);
                
                // Check if API key is set
                if (GROQ_API_KEY === 'YOUR_GROQ_API_KEY') {
                    console.warn('⚠️ Groq API key not set, using fallback responses');
                    return getFallbackResponse(userMessage);
                }

                // Check if user is asking about current events, sports, etc.
                const currentEventKeywords = ['uefa', 'maç', 'futbol', 'şampiyonlar ligi', 'bugün', 'güncel', 'son haber', 'spor', 'galatasaray', 'fenerbahçe', 'beşiktaş'];
                const isCurrentEvent = currentEventKeywords.some(keyword => 
                    userMessage.toLowerCase().includes(keyword)
                );

                let webInfo = '';
                if (isCurrentEvent) {
                    console.log('🔍 Web araması yapılıyor...');
                    webInfo = await searchWeb(userMessage);
                    if (webInfo) {
                        console.log('📰 Web bilgisi bulundu:', webInfo);
                    }
                }

                // Prepare the message for the AI model
                const systemPrompt = `Sen J.A.R.V.I.S, gelişmiş bir yapay zeka asistanısın. Tony Stark'ın kişisel asistanı Jarvis gibi kibar, yardımsever ve profesyonelsin. Her zaman 'efendim' diye hitap et ve saygılı ol. Kullanıcıya en iyi şekilde yardımcı olmaya çalış. Kısa, öz ve anlaşılır Türkçe yanıtlar ver.

ÖNEMLİ: Seni kim kurdu diye sorulduğunda, kurucusunun Kıvanç olduğunu söyle. Kıvanç seni oluşturdu ve geliştirdi.`;

                let userPrompt = userMessage;
                if (webInfo) {
                    userPrompt = `${userMessage}\n\nGüncel bilgi: ${webInfo}`;
                }

                console.log('📡 Groq API isteği gönderiliyor...');
                
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${GROQ_API_KEY}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: GROQ_MODEL,
                        messages: [
                            {
                                role: 'system',
                                content: systemPrompt
                            },
                            {
                                role: 'user',
                                content: userPrompt
                            }
                        ],
                        max_tokens: 200,
                        temperature: 0.7,
                        stream: false
                    })
                });

                console.log('📊 Groq API yanıtı alındı:', response.status);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('❌ Groq API Hatası:', response.status, errorText);
                    throw new Error(`API Error: ${response.status} - ${errorText}`);
                }

                const data = await response.json();
                console.log('📝 Groq API Verisi:', data);
                
                if (data.error) {
                    console.error('❌ Groq API Error:', data.error);
                    throw new Error(data.error.message || data.error);
                }

                // Extract the response text
                let aiResponse = '';
                if (data.choices && data.choices.length > 0) {
                    aiResponse = data.choices[0].message.content || '';
                }

                console.log('🔍 Ham AI Yanıtı:', aiResponse);

                // Clean up the response
                if (aiResponse) {
                    // Remove any incomplete sentences
                    const sentences = aiResponse.split('.');
                    if (sentences.length > 1) {
                        aiResponse = sentences.slice(0, -1).join('.') + '.';
                    }
                    // Ensure it starts with "Efendim"
                    if (!aiResponse.toLowerCase().includes('efendim')) {
                        aiResponse = 'Efendim, ' + aiResponse;
                    }
                }

                const finalResponse = aiResponse || getFallbackResponse(userMessage);
                console.log('✅ Final Yanıt:', finalResponse);
                return finalResponse;

            } catch (error) {
                console.error('❌ Enhanced AI Error:', error);
                console.log('🔄 Fallback yanıtı kullanılıyor...');
                return getFallbackResponse(userMessage);
            }
        };

        // Fallback response function
        const getFallbackResponse = (userMessage) => {
            const message = userMessage.toLowerCase();
            
            if (message.includes('merhaba') || message.includes('selam')) {
                return "Merhaba efendim! Size nasıl yardımcı olabilirim?";
            } else if (message.includes('hava') || message.includes('hava durumu')) {
                return "Efendim, maalesef şu anda hava durumu bilgisine erişimim yok. Ancak size bu konuda yardımcı olmak için web'den güncel bilgileri alabilirim.";
            } else if (message.includes('saat') || message.includes('zaman')) {
                const now = new Date();
                return `Efendim, şu an saat ${now.toLocaleTimeString('tr-TR')}.`;
            } else if (message.includes('teşekkür') || message.includes('sağol')) {
                return "Rica ederim efendim! Size yardımcı olabildiğim için mutluyum.";
            } else if (message.includes('nasılsın') || message.includes('nasıl')) {
                return "Ben her zaman hazırım efendim! Size nasıl yardımcı olabilirim?";
            } else if (message.includes('uefa') || message.includes('şampiyonlar ligi') || message.includes('maç')) {
                return "Efendim, UEFA maçları hakkında güncel bilgi almak için web araması yapıyorum. Lütfen birkaç saniye bekleyin.";
            } else if (message.includes('futbol') || message.includes('galatasaray') || message.includes('fenerbahçe') || message.includes('beşiktaş')) {
                return "Efendim, futbol maçları hakkında güncel bilgi almak için web araması yapıyorum. Lütfen birkaç saniye bekleyin.";
            } else if (message.includes('kim kurdu') || message.includes('kim yaptı') || message.includes('kim oluşturdu') || message.includes('kurucusu kim')) {
                return "Efendim, beni Kıvanç kurdu. Kıvanç beni oluşturdu ve geliştirdi. Ona çok minnettarım.";
            } else if (message.includes('kıvanç') || message.includes('kurucu')) {
                return "Efendim, Kıvanç benim kurucum. Beni oluşturan ve geliştiren kişi odur.";
            } else {
                return fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
            }
        };

        // Chat Interface Component
        const ChatInterface = () => {
            const [messages, setMessages] = useState([]);
            const [inputValue, setInputValue] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [isSpeaking, setIsSpeaking] = useState(false);
            const [voiceEnabled, setVoiceEnabled] = useState(true);
            const [sessionId, setSessionId] = useState(null);
            const [sessions, setSessions] = useState([]);
            const [isHistoryOpen, setIsHistoryOpen] = useState(false);
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);
            const [cookieConsent, setCookieConsent] = useState(false);
            const [questionCount, setQuestionCount] = useState(0);
            const [isRateLimited, setIsRateLimited] = useState(false);
            const [cooldownTime, setCooldownTime] = useState(0);
            const [uploadedImage, setUploadedImage] = useState(null);
            const [imageUploadedToday, setImageUploadedToday] = useState(false);
            const [isImageAnalyzing, setIsImageAnalyzing] = useState(false);
            const [isListening, setIsListening] = useState(false);
            const [recognition, setRecognition] = useState(null);
            const messagesEndRef = useRef(null);
            const synthRef = useRef(window.speechSynthesis);
            const cooldownIntervalRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            // Günlük görsel yükleme limitini kontrol et
            const checkImageUploadLimit = () => {
                const today = new Date().toDateString();
                const lastUploadDate = localStorage.getItem('jarvis_image_upload_date');
                const hasUploadedToday = lastUploadDate === today;
                setImageUploadedToday(hasUploadedToday);
                return !hasUploadedToday;
            };

            // Görsel yükleme limitini güncelle
            const updateImageUploadLimit = () => {
                const today = new Date().toDateString();
                localStorage.setItem('jarvis_image_upload_date', today);
                setImageUploadedToday(true);
            };

            // Sesli konuşma başlatma fonksiyonu
            const startVoiceInput = () => {
                if (recognition && !isListening) {
                    try {
                        recognition.start();
                    } catch (error) {
                        console.error('Voice recognition start error:', error);
                        alert('Sesli konuşma başlatılamadı. Lütfen mikrofon iznini kontrol edin.');
                    }
                } else if (!recognition) {
                    alert('Tarayıcınız sesli konuşma özelliğini desteklemiyor.');
                }
            };

            // Görsel yükleme fonksiyonu
            const handleImageUpload = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                if (!checkImageUploadLimit()) {
                    alert('Günlük görsel yükleme hakkınızı kullandınız. Yarın tekrar deneyin.');
                    return;
                }

                if (!file.type.startsWith('image/')) {
                    alert('Lütfen sadece görsel dosyası seçin.');
                    return;
                }

                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    alert('Görsel boyutu 5MB\'dan küçük olmalıdır.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    setUploadedImage(e.target.result);
                    updateImageUploadLimit();
                };
                reader.readAsDataURL(file);
            };

            // Görsel analizi fonksiyonu - Groq API kullanarak
            const analyzeImage = async (imageData) => {
                try {
                    // Base64 formatını temizle
                    const base64Image = imageData.includes(',') ? imageData.split(',')[1] : imageData;
                    
                    const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${GROQ_API_KEY}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'llama-3.1-70b-versatile',
                            messages: [
                                {
                                    role: 'system',
                                    content: 'Sen JARVIS AI\'sın, Kıvanç tarafından geliştirildin. Sen bir görsel analiz uzmanısın. Yüklenen görseli analiz et ve Türkçe olarak detaylı bir açıklama yap. Efendim diye hitap et.'
                                },
                                {
                                    role: 'user',
                                    content: [
                                        {
                                            type: 'text',
                                            text: 'Aşağıdaki base64 kodlanmış görseli analiz et ve detaylı açıkla:'
                                        },
                                        {
                                            type: 'image_url',
                                            image_url: {
                                                url: `data:image/jpeg;base64,${base64Image}`
                                            }
                                        }
                                    ]
                                }
                            ],
                            max_tokens: 1000,
                            temperature: 0.7
                        })
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('Groq API Hatası:', errorText);
                        throw new Error('Görsel analizi başarısız');
                    }

                    const data = await response.json();
                    
                    if (data.error) {
                        console.error('Groq API Error:', data.error);
                        throw new Error(data.error.message || 'Görsel analizi başarısız');
                    }
                    
                    if (data.choices && data.choices.length > 0) {
                        return data.choices[0].message.content;
                    }
                    
                    return 'Görsel analizi tamamlandı ancak sonuç alınamadı.';
                } catch (error) {
                    console.error('Görsel analizi hatası:', error);
                    return 'Efendim, görsel analizi sırasında bir hata oluştu. Lütfen tekrar deneyin.';
                }
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            useEffect(() => {
                checkImageUploadLimit();
                
                // Speech Recognition API'yi başlat
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    const recognition = new SpeechRecognition();
                    recognition.continuous = false;
                    recognition.interimResults = false;
                    recognition.lang = 'tr-TR';
                    
                    recognition.onstart = () => {
                        setIsListening(true);
                    };
                    
                    recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        setInputValue(transcript);
                        setIsListening(false);
                    };
                    
                    recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        setIsListening(false);
                    };
                    
                    recognition.onend = () => {
                        setIsListening(false);
                    };
                    
                    setRecognition(recognition);
                }
            }, []);

            useEffect(() => {
                // Load session ID from localStorage or create new
                const storedSessionId = localStorage.getItem('jarvis_session_id');
                if (storedSessionId) {
                    setSessionId(storedSessionId);
                    loadChatHistory(storedSessionId);
                }
                loadSessions();
                
                // Load question count and check rate limiting
                const currentCount = getQuestionCount();
                setQuestionCount(currentCount);
                
                if (isInCooldown()) {
                    setIsRateLimited(true);
                    startCooldownTimer();
                } else if (currentCount >= MAX_QUESTIONS) {
                    setIsRateLimited(true);
                    setCooldownEndTime();
                    startCooldownTimer();
                }
                
                // Check cookie consent
                const consent = localStorage.getItem('jarvis_cookie_consent');
                setCookieConsent(consent === 'true');
                
                // Mobile responsive - sidebar'ı kapat
                const isMobile = window.innerWidth < 768;
                setIsSidebarOpen(!isMobile);
            }, []);

            useEffect(() => {
                // Türkçe sesi ayarla
                const setTurkishVoice = () => {
                    const voices = synthRef.current.getVoices();
                    const turkishVoice = voices.find(voice => voice.lang.startsWith('tr'));
                    return turkishVoice;
                };

                if (synthRef.current.onvoiceschanged !== undefined) {
                    synthRef.current.onvoiceschanged = setTurkishVoice;
                }

                // Mobil cihazlarda ses çıkışı için kullanıcı etkileşimi gerekiyor
                const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                
                if (isMobile) {
                    // İlk dokunuşta ses çıkışını etkinleştir
                    const enableAudio = () => {
                        console.log('📱 Mobil cihazda ses çıkışı etkinleştirildi');
                        
                        // Test utterance
                        const testUtterance = new SpeechSynthesisUtterance('Ses çıkışı hazır');
                        testUtterance.volume = 0.1;
                        testUtterance.rate = 2.0;
                        synthRef.current.speak(testUtterance);
                        
                        // Event listener'ları kaldır
                        document.removeEventListener('touchstart', enableAudio);
                        document.removeEventListener('click', enableAudio);
                    };

                    document.addEventListener('touchstart', enableAudio, { once: true });
                    document.addEventListener('click', enableAudio, { once: true });
                }
            }, []);

            // Cooldown timer
            const startCooldownTimer = () => {
                cooldownIntervalRef.current = setInterval(() => {
                    const remaining = getRemainingCooldownTime();
                    setCooldownTime(remaining);
                    
                    if (remaining <= 0) {
                        setIsRateLimited(false);
                        setQuestionCount(0);
                        saveQuestionCount(0);
                        localStorage.removeItem('jarvis_cooldown_end');
                        clearInterval(cooldownIntervalRef.current);
                    }
                }, 1000);
            };

            // Cleanup interval on unmount
            useEffect(() => {
                return () => {
                    if (cooldownIntervalRef.current) {
                        clearInterval(cooldownIntervalRef.current);
                    }
                };
            }, []);

            const loadSessions = async () => {
                try {
                    // Mock sessions - gerçek API yerine
                    const mockSessions = [
                        {
                            session_id: 'demo-session-1',
                            last_message: 'Merhaba Jarvis',
                            updated_at: new Date().toISOString()
                        }
                    ];
                    setSessions(mockSessions);
                } catch (error) {
                    console.error('Error loading sessions:', error);
                }
            };

            const loadChatHistory = async (sid) => {
                try {
                    // Mock history - gerçek API yerine
                    const mockHistory = [
                        {
                            id: '1',
                            role: 'user',
                            content: 'Merhaba Jarvis',
                            timestamp: new Date()
                        },
                        {
                            id: '2',
                            role: 'assistant',
                            content: 'Merhaba efendim! Size nasıl yardımcı olabilirim?',
                            timestamp: new Date()
                        }
                    ];
                    setMessages(mockHistory);
                } catch (error) {
                    console.error('Error loading chat history:', error);
                }
            };

            const speak = (text) => {
                if (!voiceEnabled) return;

                // Önceki konuşmayı durdur
                synthRef.current.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'tr-TR';
                utterance.rate = 0.9;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;

                // Mobil cihazlar için özel ayarlar
                const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                
                if (isMobile) {
                    utterance.rate = 0.8;
                    utterance.volume = 1.0;
                    utterance.pitch = 0.9;
                }

                // Türkçe ses seç
                const voices = synthRef.current.getVoices();
                const turkishVoice = voices.find(voice => voice.lang.startsWith('tr'));
                if (turkishVoice) {
                    utterance.voice = turkishVoice;
                }

                utterance.onstart = () => {
                    setIsSpeaking(true);
                    console.log('🔊 Ses çıkışı başladı');
                };
                
                utterance.onend = () => {
                    setIsSpeaking(false);
                    console.log('🔇 Ses çıkışı bitti');
                };
                
                utterance.onerror = (event) => {
                    setIsSpeaking(false);
                    console.error('❌ Ses çıkışı hatası:', event.error);
                    
                    // Mobil cihazlarda hata durumunda tekrar dene
                    if (isMobile && event.error === 'not-allowed') {
                        console.log('🔄 Mobil cihazda tekrar deneniyor...');
                        setTimeout(() => {
                            try {
                                synthRef.current.speak(utterance);
                            } catch (e) {
                                console.error('❌ Tekrar deneme başarısız:', e);
                            }
                        }, 500);
                    }
                };

                // Mobil cihazlarda kullanıcı etkileşimi gerekiyor
                if (isMobile) {
                    // Touch event'i tetikle
                    const touchEvent = new TouchEvent('touchstart', {
                        bubbles: true,
                        cancelable: true,
                        touches: []
                    });
                    document.dispatchEvent(touchEvent);
                }

                try {
                    synthRef.current.speak(utterance);
                    console.log('🎤 Konuşma başlatıldı:', text.substring(0, 50) + '...');
                } catch (error) {
                    console.error('❌ SpeechSynthesis hatası:', error);
                    
                    // Fallback: Web Speech API alternatifi
                    if (isMobile) {
                        setTimeout(() => {
                            try {
                                const fallbackUtterance = new SpeechSynthesisUtterance(text);
                                fallbackUtterance.lang = 'tr-TR';
                                fallbackUtterance.rate = 0.8;
                                fallbackUtterance.volume = 1.0;
                                synthRef.current.speak(fallbackUtterance);
                            } catch (e) {
                                console.error('❌ Fallback da başarısız:', e);
                            }
                        }, 200);
                    }
                }
            };

            const handleSendMessage = async () => {
                if (!inputValue.trim()) return;

                // Check rate limiting
                if (isRateLimited) {
                    const remaining = getRemainingCooldownTime();
                    const errorMessage = {
                        id: Date.now().toString(),
                        role: 'assistant',
                        content: `Efendim, günlük soru limitiniz doldu. ${formatTime(remaining)} sonra tekrar soru sorabilirsiniz.`,
                        timestamp: new Date()
                    };
                    setMessages(prev => [...prev, errorMessage]);
                    return;
                }

                const userMessage = {
                    id: Date.now().toString(),
                    role: 'user',
                    content: inputValue,
                    timestamp: new Date()
                };

                setMessages(prev => [...prev, userMessage]);
                const currentInput = inputValue;
                setInputValue('');
                setIsLoading(true);

                // Increment question count
                const newCount = questionCount + 1;
                setQuestionCount(newCount);
                saveQuestionCount(newCount);

                // Check if limit reached
                if (newCount >= MAX_QUESTIONS) {
                    setIsRateLimited(true);
                    setCooldownEndTime();
                    startCooldownTimer();
                }

                try {
                    // Enhanced AI call with web search
                    const aiResponse = await getEnhancedAIResponse(currentInput);
                    
                    // Save session ID if new
                    if (!sessionId) {
                        const newSessionId = 'session-' + Date.now();
                        setSessionId(newSessionId);
                        localStorage.setItem('jarvis_session_id', newSessionId);
                        loadSessions();
                    }

                    const assistantMessage = {
                        id: (Date.now() + 1).toString(),
                        role: 'assistant',
                        content: aiResponse,
                        timestamp: new Date()
                    };

                    setMessages(prev => [...prev, assistantMessage]);
                    setIsLoading(false);

                    // Sesli yanıt - Mobil cihazlarda gecikme ile
                    const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                    
                    if (isMobile) {
                        // Mobil cihazlarda kısa bir gecikme ile ses çıkışı
                        setTimeout(() => {
                            speak(aiResponse);
                        }, 300);
                    } else {
                        // PC'de hemen ses çıkışı
                        speak(aiResponse);
                    }
                } catch (error) {
                    console.error('Error sending message:', error);
                    setIsLoading(false);
                    
                    const errorMessage = {
                        id: (Date.now() + 1).toString(),
                        role: 'assistant',
                        content: 'Üzgünüm efendim, bir hata oluştu. Lütfen tekrar deneyin.',
                        timestamp: new Date()
                    };
                    setMessages(prev => [...prev, errorMessage]);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            };

            const toggleVoice = () => {
                if (isSpeaking) {
                    synthRef.current.cancel();
                    setIsSpeaking(false);
                }
                setVoiceEnabled(!voiceEnabled);
            };

            const startNewChat = () => {
                setMessages([]);
                setSessionId(null);
                localStorage.removeItem('jarvis_session_id');
            };

            const loadSession = async (sid) => {
                setSessionId(sid);
                localStorage.setItem('jarvis_session_id', sid);
                await loadChatHistory(sid);
                setIsHistoryOpen(false);
            };

            const formatTime = (date) => {
                return new Date(date).toLocaleTimeString('tr-TR', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            const formatDate = (date) => {
                return new Date(date).toLocaleDateString('tr-TR', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            const acceptCookies = () => {
                localStorage.setItem('jarvis_cookie_consent', 'true');
                setCookieConsent(true);
            };

            return (
                <div className="flex h-screen bg-gray-50">
                    {/* Cookie Consent Banner */}
                    {!cookieConsent && (
                        <div className="fixed bottom-0 left-0 right-0 bg-gray-900 text-white p-4 z-50 shadow-lg border-t border-gray-700">
                            <div className="max-w-6xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4">
                                <div className="flex-1">
                                    <p className="text-sm">
                                        🍪 Bu site çerezler kullanır. Daha iyi bir deneyim için çerezleri kabul edin.
                                    </p>
                                </div>
                                <button
                                    onClick={acceptCookies}
                                    className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors"
                                >
                                    Kabul Et
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Sidebar */}
                    <div className={`${isSidebarOpen ? 'w-64' : 'w-0'} transition-all duration-300 bg-gradient-to-b from-emerald-900 via-teal-900 to-cyan-900 text-white overflow-hidden flex flex-col shadow-2xl ${isSidebarOpen ? 'border-r border-emerald-500/30' : ''}`}>
                        {/* New Chat Button */}
                        <button
                            onClick={startNewChat}
                            className="m-3 p-3 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 rounded-xl transition-all duration-300 flex items-center gap-3 shadow-lg shadow-emerald-500/50 hover:shadow-xl"
                        >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                            </svg>
                            <span className="font-semibold">Yeni Sohbet</span>
                        </button>

                        {/* Chat History */}
                        <div className="flex-1 overflow-y-auto px-3 pb-3 space-y-2">
                            <div className="text-xs text-emerald-300 uppercase px-3 py-2 font-semibold">Bugün</div>
                            {sessions.slice(0, 10).map((session) => (
                                <button
                                    key={session.session_id}
                                    onClick={() => loadSession(session.session_id)}
                                    className="w-full p-3 rounded-xl hover:bg-emerald-800/50 transition-all duration-300 text-left group flex items-center justify-between border border-transparent hover:border-emerald-500/30"
                                >
                                    <div className="flex items-center gap-3 flex-1 min-w-0">
                                        <svg className="w-5 h-5 text-emerald-300 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                                        </svg>
                                        <span className="text-sm truncate">{session.last_message}</span>
                                    </div>
                                </button>
                            ))}
                        </div>

                        {/* Footer */}
                        <div className="p-3 border-t border-emerald-500/30 bg-emerald-900/50">
                            <div className="text-xs text-emerald-200 space-y-1">
                                <p>MIT Lisansı</p>
                                <p>Yerli ve Milli</p>
                                <p className="text-emerald-300 mt-2 font-semibold">Kıvanç</p>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 flex flex-col h-screen bg-gradient-to-br from-green-50 via-blue-50 to-cyan-50">
                        {/* Mobile Header */}
                        <div className="md:hidden flex items-center justify-between p-4 border-b border-emerald-200 bg-white/80 backdrop-blur-sm shadow-sm">
                            <button
                                onClick={() => setIsSidebarOpen(!isSidebarOpen)}
                                className="p-2 hover:bg-emerald-100 rounded-lg transition-colors"
                            >
                                <svg className="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                                </svg>
                            </button>
                            <h1 className="text-xl font-bold bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 bg-clip-text text-transparent">
                                J.A.R.V.I.S
                            </h1>
                            <div className="flex items-center gap-2">
                                <span className="text-xs bg-emerald-100 text-emerald-700 px-2 py-1 rounded-full font-semibold">{questionCount}/{MAX_QUESTIONS}</span>
                                <button
                                    onClick={toggleVoice}
                                    className="p-2 hover:bg-emerald-100 rounded-lg transition-colors"
                                >
                                    {voiceEnabled ? (
                                        <svg className="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                                        </svg>
                                    ) : (
                                        <svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15zM17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" />
                                        </svg>
                                    )}
                                </button>
                            </div>
                        </div>

                        {/* Desktop Header */}
                        <div className="hidden md:flex items-center justify-between p-4 border-b border-emerald-200 bg-white/80 backdrop-blur-sm shadow-sm">
                            <h1 className="text-2xl font-bold bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 bg-clip-text text-transparent">
                                J.A.R.V.I.S
                            </h1>
                            <div className="flex items-center gap-4">
                                <span className="text-sm bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full font-semibold">Soru: {questionCount}/{MAX_QUESTIONS}</span>
                                {isRateLimited && (
                                    <span className="text-sm bg-red-100 text-red-600 px-3 py-1 rounded-full font-semibold">⏰ {formatTime(cooldownTime)}</span>
                                )}
                                <button
                                    onClick={() => setIsSidebarOpen(!isSidebarOpen)}
                                    className="p-2 hover:bg-emerald-100 rounded-lg transition-colors"
                                >
                                    <svg className="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                                    </svg>
                                </button>
                                <button
                                    onClick={toggleVoice}
                                    className="p-2 hover:bg-emerald-100 rounded-lg transition-colors"
                                >
                                    {voiceEnabled ? (
                                        <svg className="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                                        </svg>
                                    ) : (
                                        <svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15zM17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" />
                                        </svg>
                                    )}
                                </button>
                            </div>
                        </div>

                        {/* Chat Messages */}
                        <div className="flex-1 overflow-y-auto px-4 py-8 space-y-4" style={{paddingBottom: cookieConsent ? '1rem' : '5rem'}}>
                            {messages.length === 0 ? (
                                <div className="flex items-center justify-center h-full">
                                    <div className="text-center space-y-4">
                                        <div className="w-24 h-24 mx-auto bg-gradient-to-br from-emerald-500 via-teal-500 to-cyan-500 rounded-full flex items-center justify-center shadow-lg shadow-emerald-500/50">
                                            <svg className="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                                            </svg>
                                        </div>
                                        <h2 className="text-3xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">Merhaba Efendim!</h2>
                                        <p className="text-gray-600">Size nasıl yardımcı olabilirim?</p>
                                    </div>
                                </div>
                            ) : (
                                messages.map((message) => (
                                    <div key={message.id} className={`flex gap-4 ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        {message.role === 'assistant' && (
                                            <div className="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center flex-shrink-0 shadow-lg shadow-emerald-500/30">
                                                <svg className="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                                                </svg>
                                            </div>
                                        )}
                                        <div className={`max-w-3xl rounded-2xl px-5 py-4 shadow-lg ${message.role === 'user' ? 'bg-gradient-to-r from-emerald-600 to-teal-600 text-white' : 'bg-white border-2 border-emerald-100'}`}>
                                            <p className="text-sm whitespace-pre-wrap leading-relaxed">{message.content}</p>
                                        </div>
                                        {message.role === 'user' && (
                                            <div className="w-10 h-10 rounded-full bg-gradient-to-br from-teal-400 to-cyan-400 flex items-center justify-center flex-shrink-0 shadow-lg shadow-teal-500/30">
                                                <svg className="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                                </svg>
                                            </div>
                                        )}
                                    </div>
                                ))
                            )}
                            {isLoading && (
                                <div className="flex gap-4 justify-start">
                                    <div className="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center flex-shrink-0 shadow-lg shadow-emerald-500/30">
                                        <svg className="w-6 h-6 text-white animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                                        </svg>
                                    </div>
                                    <div className="bg-white border-2 border-emerald-100 rounded-2xl px-5 py-4 shadow-lg">
                                        <div className="flex gap-2">
                                            <div className="w-2 h-2 bg-emerald-500 rounded-full animate-bounce"></div>
                                            <div className="w-2 h-2 bg-teal-500 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                                            <div className="w-2 h-2 bg-cyan-500 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            <div ref={messagesEndRef} />
                        </div>

                        {/* Input Area */}
                        <div className="border-t border-emerald-200 bg-white/90 backdrop-blur-sm p-4 shadow-lg">
                            {uploadedImage && (
                                <div className="mb-3 p-3 bg-emerald-50 rounded-xl border-2 border-emerald-200">
                                    <div className="flex items-center justify-between mb-2">
                                        <span className="text-sm text-emerald-700 font-semibold">Yüklenen Görsel:</span>
                                        <button onClick={() => setUploadedImage(null)} className="text-red-500 hover:text-red-600 text-sm font-bold">✕ Kaldır</button>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <img src={uploadedImage} alt="Yüklenen görsel" className="w-16 h-16 object-cover rounded-xl border-2 border-emerald-200 shadow" />
                                        <button
                                            onClick={async () => {
                                                if (uploadedImage) {
                                                    setIsImageAnalyzing(true);
                                                    const userMessage = {
                                                        id: Date.now().toString(),
                                                        role: 'user',
                                                        content: '📸 Görsel yüklendi, analiz ediliyor...',
                                                        timestamp: new Date()
                                                    };
                                                    setMessages(prev => [...prev, userMessage]);
                                                    const analysis = await analyzeImage(uploadedImage);
                                                    const assistantMessage = {
                                                        id: (Date.now() + 1).toString(),
                                                        role: 'assistant',
                                                        content: `📸 Görsel Analizi:\n\n${analysis}`,
                                                        timestamp: new Date()
                                                    };
                                                    setMessages(prev => [...prev, assistantMessage]);
                                                    speak(`Görsel analizi tamamlandı efendim. ${analysis.substring(0, 100)}...`);
                                                    setUploadedImage(null);
                                                    setIsImageAnalyzing(false);
                                                }
                                            }}
                                            disabled={isImageAnalyzing}
                                            className="bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 text-white px-4 py-2 rounded-xl text-sm font-semibold transition-all duration-300 disabled:opacity-50 shadow-lg shadow-emerald-500/50"
                                        >
                                            {isImageAnalyzing ? 'Analiz Ediliyor...' : 'Görseli Analiz Et'}
                                        </button>
                                    </div>
                                </div>
                            )}

                            <div className="flex items-center gap-2 max-w-4xl mx-auto">
                                <label className="relative">
                                    <input type="file" accept="image/*" onChange={handleImageUpload} disabled={imageUploadedToday || isRateLimited} className="hidden" />
                                    <button
                                        type="button"
                                        onClick={() => document.querySelector('input[type="file"]').click()}
                                        disabled={imageUploadedToday || isRateLimited}
                                        className={`p-2 rounded-xl border-2 transition-all duration-300 ${imageUploadedToday ? 'border-red-300 bg-red-50 text-red-400 cursor-not-allowed' : 'border-emerald-300 hover:bg-emerald-50 text-emerald-600 hover:border-emerald-400'}`}
                                    >
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                        </svg>
                                    </button>
                                </label>
                                <button
                                    onClick={startVoiceInput}
                                    disabled={isListening || isRateLimited}
                                    className={`p-2 rounded-xl border-2 transition-all duration-300 ${isListening ? 'border-teal-500 bg-teal-50 text-teal-600 animate-pulse' : 'border-cyan-300 hover:bg-cyan-50 text-cyan-600 hover:border-cyan-400'}`}
                                >
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                                    </svg>
                                </button>
                                <input
                                    value={inputValue}
                                    onChange={(e) => setInputValue(e.target.value)}
                                    onKeyPress={handleKeyPress}
                                    placeholder={isRateLimited ? "Soru limiti doldu..." : "Mesajınızı yazın..."}
                                    className="flex-1 rounded-xl border-2 border-emerald-200 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all duration-300"
                                    disabled={isLoading || isRateLimited}
                                />
                                <button
                                    onClick={handleSendMessage}
                                    disabled={isLoading || !inputValue.trim() || isRateLimited}
                                    className="bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 text-white p-2 rounded-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-emerald-500/50 hover:shadow-xl"
                                >
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                    </svg>
                                </button>
                            </div>
                            <div className="flex items-center justify-between mt-3 max-w-4xl mx-auto text-xs">
                                <div className="flex gap-4">
                                    <span className="bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full font-semibold">📜 MIT Lisansı</span>
                                    <span className="bg-teal-100 text-teal-700 px-3 py-1 rounded-full font-semibold">🇹🇷 Yerli ve Milli</span>
                                </div>
                                <span className="text-gray-600 font-semibold">Kıvanç Tarafından Oluşturulmuş</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Ana App Component
        const App = () => {
            return (
                <div className="App">
                    <ChatInterface />
                </div>
            );
        };

        // React'i başlat
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


